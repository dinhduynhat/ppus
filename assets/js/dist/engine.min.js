var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,k,e){b!=Array.prototype&&b!=Object.prototype&&(b[k]=e.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,k,e,g){if(k){e=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var K=b[g];K in e||(e[K]={});e=e[K]}b=b[b.length-1];g=e[b];k=k(g);k!=g&&null!=k&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:k})}};$jscomp.polyfill("Object.is",function(b){return b?b:function(b,e){return b===e?0!==b||1/b===1/e:b!==b&&e!==e}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(b,e){var g=this;g instanceof String&&(g=String(g));var k=g.length;for(e=e||0;e<k;e++)if(g[e]==b||Object.is(g[e],b))return!0;return!1}},"es7","es3");
$jscomp.checkStringArgs=function(b,k,e){if(null==b)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(k instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return b+""};$jscomp.polyfill("String.prototype.includes",function(b){return b?b:function(b,e){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,e||0)}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(b,e,g){var k=this.length||0;0>e&&(e=Math.max(0,k+e));if(null==g||g>k)g=k;g=Number(g);0>g&&(g=Math.max(0,k+g));for(e=Number(e||0);e<g;e++)this[e]=b;return this}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;
$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(b){var k=0;return $jscomp.iteratorPrototype(function(){return k<b.length?{done:!1,value:b[k++]}:{done:!0}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,k){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var e=0,g={next:function(){if(e<b.length){var K=e++;return{value:k(K,b[K]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6-impl","es3");
function isurl(b){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(b)}
var serverConnected=!1,clanName="",knownSkins=[],streaks=[],pastClans={};function plz(){var b=Please.make_color({colors_returned:50,saturation:1,value:1});return b[Math.floor(Math.random()*b.length)]}
(function(b,k){function e(){ws&&(ws.onopen=null,ws.onmessage=null,ws.onerror=null,ws.onclose=null,ws.close(),V(),serverStatID&&(clearInterval(serverStatID),serverStatID=null),ws=null,v={},M=[],D=[],U=[],u=[],x="none",F=G=L=0,X=Y=-1,Q=R=0,W=1,Z=!1,z=ga,A=[],H=1,chatText="",serverVersion="Unknown",serverStatCanvas=I=serverStats=null,serverConnected=!1,NProgress.done())}function g(){J=$("#nick").val();clanName=$("#clan").val();disconnectDelay=1;serverConnected=!0;msend(7);r(ta);r(ua);serverVersion="Unknown";
log.info("Connection established successfully!");$("#serverConnecting").hide();$("#mainButtons").show();NProgress.done()}function K(a){var c=new Reader(new DataView(a.data),0,!0),m,d=c.getUint8();switch(d){case 32:D.push(c.getUint32());break;case 99:var d=c.getUint8(),b=c.getUint8(),f=c.getUint8(),g=c.getUint8();for(a=(b<<16|f<<8|g).toString(16);6>a.length;)a="0"+a;a="#"+a;var l=c.getStringUTF8().trim();(m=/\[([^]+)\]/.exec(l))&&2===m.length&&-1===$.inArray(m[1],knownSkins)&&(l=l.replace(m[0],"").trim());
m=!!(d&128);var t=!!(d&64),d=!!(d&32);m&&"SERVER"!==l&&(l="[SERVER] "+l);t&&(l="[ADMIN] "+l);d&&(l="[MOD] "+l);c=c.getStringUTF8();chatAlphaWait+=Math.max(3E3,1E3+150*c.length);chatMessages.push({server:m,admin:t,mod:d,nameColor:a,name:l,message:c,time:Date.now()});sfx("chat");N();break;case 18:for(l in v)v[l].destroy(Date.now());case 20:D=[];break;case 21:break;case 254:serverStats=JSON.parse(c.getStringUTF8());X=Date.now()-Y;ha();break;case 64:z.left=c.getFloat64();z.top=c.getFloat64();z.right=
c.getFloat64();z.bottom=c.getFloat64();33!==a.data.byteLength&&(c.getUint32(),serverVersion="Popsplit.us",serverVersion.includes("Popsplit.us")&&!serverStatID&&(serverStatID=setInterval(function(){Y=Date.now();r(B[254])},2E3)));0!==D.length||Z||(Z=!0,R=(z.right+z.left)/2,Q=(z.bottom+z.top)/2,G=R,F=Q);break;case 48:u=[];48!=x&&(x=48,log.info("Got somewhat deprecated leaderboard type 48 (0x30). Server-side is possibly Ogar"));m=c.getUint32();for(l=0;l<m;++l)u.push(c.getStringUTF8());aa();break;case 49:u=
[];x=49;m=c.getUint32();for(l=0;l<m;++l)u.push({me:c.getUint32(),name:c.getStringUTF8()||"An unnamed cell"});aa();break;case 50:u=[];x=50;m=c.getUint32();for(l=0;l<m;++l)u.push(c.getFloat32());aa();break;case 16:a=Date.now();m=c.getUint16();for(l=0;l<m;l++)d=c.getUint32(),t=c.getUint32(),v.hasOwnProperty(d)&&v.hasOwnProperty(t)&&(v[t].killer=v[d],v[t].destroy());for(;;){m=c.getUint32();if(0===m)break;t=c.getInt32();var k=c.getInt32();var p=c.getUint16();d=c.getUint8();var q=!!(d&2);var C=!!(d&8);
var A=!!(d&4);var y=l=b=null;if(q){b="";b=c.getUint8();f=c.getUint8();g=c.getUint8();for(b=(b<<16|f<<8|g).toString(16);6>b.length;)b="0"+b;b="#"+b}A&&(y=c.getStringUTF8());C&&(l=c.getStringUTF8());v.hasOwnProperty(m)?(d=v[m],d.nx=t,d.ny=k,d.nSize=p,q&&d.setColor(b),C&&l&&d.setName(l),A&&y&&d.setSkin(y),d.updateStamp=a):(d=new ia(m,t,k,p,l||"",b||"#FFFFFF",y||"",a,d),v[m]=d,M.push(d))}m=c.getUint16();for(l=0;l<m;l++)t=c.getUint32(),v.hasOwnProperty(t)&&v[t].destroy(a);m=M.length;for(l=0;l<m;l++)d=
M[l],d.isPellet||d.notPellet||d.isVirus||d.isAgitated||d.isEjected||(d.updateStamp!==a&&d.birthStamp!==a?(c=document.createElement("canvas"),t=c.getContext("2d"),k=20<this.nSize?Math.max(.01*this.nSize,10):0,c.width=2*(p=d.nSize+k),c.height=2*p,t.lineWidth=k,t.lineCap=t.lineJoin="round",t.fillStyle=d.color,t.strokeStyle=d.color,t.beginPath(),t.arc(p,p,d.nSize-k,0,2*Math.PI,!1),t.fill(),t.closePath(),d._meCache=c,d._meW=c.width/2,d._meH=c.height/2,d.isPellet=!0):d.updateStamp===a&&d.birthStamp!==a&&
(d.notPellet=!0));break;case 17:R=c.getFloat32();Q=c.getFloat32();W=c.getFloat32();break;default:log.err("Got unexpected packet ID "+d),e()}}function va(a){clanName=$("#clan").val();J=$("#nick").val();log.warn("Connection error");log.debug(a);serverConnected=!1;NProgress.done();S++;3<S?(S=0,connector("random")):connector()}function wa(){clanName=$("#clan").val();J=$("#nick").val();log.debug("Disconnected");e();S++;3<S?(S=0,connector("random")):connector()}function r(a){ws&&1===ws.readyState&&(a.build?
ws.send(a.build()):ws.send(a))}function ja(){var a=$("#nick").val().trim(),c=$("#clan").val()?"{"+$("#clan").val().trim().replace("{","").replace("}","")+"} ":"",b=$("#customSkin").val()?"["+$("#customSkin").val().trim()+"] ":"";window.localStorage.setItem("clanName",$("#clan").val().trim());window.localStorage.setItem("customSkin",$("#customSkin").val().trim());!window.location.pathname.includes("chewy")&&a.toLowerCase().replace(/\s/g,"").includes("chewy")&&(a="[evil] Imposter");a.includes("*")&&
(a=a.replace("*",""));a=b+c+a;log.debug("Playing");c=new Writer(!0);c.setUint8(0);c.setStringUTF8(a);J=a;r(c);msend(2)}function ba(){0< !$(".modal.in").length&&(escOverlay=!1,k("#overlays").fadeOut(50))}function V(a){escOverlay=!0;userNickName=null;k("#overlays").fadeIn(50)}function ka(){if(isTyping)return 1;var a=Date.now(),c=chatMessages.peek();return 1-Math.min(Math.max(.001*(a-c.time-chatAlphaWait),0),1)}function N(){if(f.showChat&&0!==chatMessages.length){chatCanvas||(chatCanvas=document.createElement("canvas"));
var a=chatCanvas.getContext("2d"),c;Date.now();var b=0;chatMessages.peek();var d=0;var E=ka();if(0===E)chatCanvas=null,chatAlphaWait=0;else{for(;15<(c=chatMessages.length);)chatMessages.shift();for(;b<c;b++){var e=chatMessages[b];a.font="18px Montserrat";d=Math.max(d,20+a.measureText(e.name+":").width+a.measureText(" "+e.message).width)}chatCanvas.width=d;chatCanvas.height=20*c+20;a.fillStyle="#000000";a.globalAlpha=.2*E;a.fillRect(0,0,chatCanvas.width,chatCanvas.height);a.globalAlpha=E;for(b=0;b<
c;b++)e=chatMessages[b],a.fillStyle=e.nameColor,a.font="18px Montserrat",d=a.measureText(e.name+":").width,a.font="18px Montserrat",a.fillText(e.name+":",10,5+20*(b+1)),a.font="18px Montserrat",a.fillStyle="#FFFFFF",a.fillText(" "+e.message,10+d,5+20*(b+1))}}else chatCanvas=null}function ha(){if(serverStats){serverStatCanvas||(serverStatCanvas=document.createElement("canvas"));var a=serverStatCanvas.getContext("2d"),c,b,d;a.font="14px Montserrat";serverStatCanvas.width=4+Math.max(a.measureText(serverStats.name).width,
a.measureText(serverStats.mode).width,a.measureText(c=serverStats.playersTotal+" / "+serverStats.playersLimit+" players").width,a.measureText(b=serverStats.playersAlive+" playing").width,a.measureText(d=serverStats.playersSpect+" spectating").width);serverStatCanvas.height=85;f.darkTheme?$("#serverstatus").attr("style","color: #FFFFFF;"):$("#serverstatus").attr("style","color: #111111;");console.log(serverStats);"minions"==$("#gamemode option:selected").attr("mode")?($("#statsPlayers").html(Math.round(serverStats.playersTotal/
4)+" / "+serverStats.playersLimit),$("#statsPlaying").html(Math.round(serverStats.playersTotal/4)-serverStats.playersSpect),$("#statsSpec").html(serverStats.playersSpect)):($("#statsPlayers").html(serverStats.playersTotal+" / "+serverStats.playersLimit),$("#statsPlaying").html(serverStats.playersTotal-serverStats.playersSpect),$("#statsSpec").html(serverStats.playersSpect),$("#statsLoad").html(Math.round(serverStats.update)+"%"),$("#statsUptime").html(serverStats.uptime));a.font="14px Montserrat";
a.fillStyle=f.darkTheme?"#AAAAAA":"#000000";a.globalAlpha=1;a.fillText(serverStats.name,2,16);a.fillText(serverStats.mode,2,32);a.fillText(c,2,48);a.fillText(b,2,64);a.fillText(d,2,80)}else serverStatCanvas=null}function aa(){var a;if(-1!==x)if(0===u.length)I=null;else{I||(I=document.createElement("canvas"));var c=I.getContext("2d"),b=u.length;width=50!==x?60+24*b:240;i=0;I.width=300;I.height=width;c.globalAlpha=.4;c.fillStyle="#000000";c.fillRect(0,0,300,width);c.globalAlpha=1;c.fillStyle="#FFFFFF";
c.font="30px Montserrat";c.fillText("Leaderboard",150-c.measureText("Leaderboard").width/2,40);if(50===x){c.beginPath();for(var d=0;i<b;i++)c.fillStyle=xa[i],c.moveTo(100,140),c.arc(100,140,80,d,d+=u[i]*ca,!1),c.fill();c.closePath()}else{var E=!1,e;for(c.font="20px Montserrat";i<b;i++)d=u[i],49===x&&(E=d.me,d=d.name),(a=/\[([^]+)\]/.exec(u[0].name))&&2===a.length&&-1===$.inArray(a[1],knownSkins)&&(u[0].name=u[0].name.replace(a[0],"").trim()),u[0].name!=la&&(la=u[0].name,sfx("leaderboard"),ui.alert(u[0].name+
" is now in 1st place!"),(a=/\{([^]+)\}/.exec(u[0].name))&&2===a.length&&a[1]!=ma&&(ma=a[1],ui.alert('The clan <span style="color: '+pastClans[a[1]]+'">'+a[1]+"</span> is now in the lead!",!0),sfx("explosion"))),(a=/\[([^]+)\]/.exec(d))&&2===a.length&&-1===$.inArray(a[1],knownSkins)&&(d=d.replace(a[0],"").trim()),49===x&&(d=d||"An unnamed cell"),c.fillStyle="#FFFFFF",E&&(c.fillStyle="#FFAAAA"),"*"==d[0]&&(c.fillStyle=f.darkTheme?"#a5a5a5":"#dddddd"),"clanwars"==connected.name.toLowerCase()?(a=/\{([^]+)\}/.exec(d))&&
2===a.length&&(pastClans[a[1]]?c.fillStyle=pastClans[a[1]]:pastClans[a[1]]=plz()):(a=/\{([^]+)\}/.exec(d))&&2===a.length&&$("#clan").val()==a[1]&&!E&&(c.fillStyle=na.yellow),d=i+1+". "+d,a=300<(e=c.measureText(d).width)?2:150-.5*e,c.fillText(d,a,70+24*i)}}}function oa(){pa(!0);window.requestAnimationFrame(oa)}function pa(){var a=Date.now();fps+=.1*(1E3/(a-lastDrawTime)-fps);lastDrawTime=a;isNaN(fps)&&(fps=0);var c=mainCanvas.width=b.innerWidth,m=mainCanvas.height=b.innerHeight,d=c/2,E=m/2,e=_viewMult,
g,l=M.concat(U);mainCtx.save();mainCtx.fillStyle=f.darkTheme?"#111111":"#F2FBFF";mainCtx.fillRect(0,0,c,m);mainCtx.restore();var t;if(f.showGrid&&!f.qualityRef.overrideGrid){mainCtx.save();mainCtx.strokeStyle=f.darkTheme?"#AAAAAA":"#000000";mainCtx.globalAlpha=.2;cW=mainCanvas.width/C;cH=mainCanvas.height/C;startLeft=(-G+.5*cW)%50;startTop=(-F+.5*cH)%50;i=startLeft;for(mainCtx.scale(C,C);i<cW;i+=50)mainCtx.moveTo(i,-.5),mainCtx.lineTo(i,cH);for(i=startTop;i<cH;i+=50)mainCtx.moveTo(-.5,i),mainCtx.lineTo(cW,
i);mainCtx.stroke();mainCtx.restore()}var k=l.length;for(g=0;g<k;g++)n=l[g],dt=Math.max(Math.min((a-n.appStamp)/120,1),0),n.updateAppearance(a,dt);k=D.length;g=_viewMult;var u=0;if(0<k){var z=0,r=0,x=0;for(i=H=0;i<k;i++)if(n=v[D[i]])H=f.monoZoom?1E3:H+n.size,u+=~~(n.nSize*n.nSize*.01),z+=n.x,r+=n.y,x++;0<x?(L=Math.max(u,L),G+=.4*(~~(z/x)-G),F+=.4*(~~(r/x)-F),k=H=Math.pow(Math.min(64/H,1),.4)):k=H=1}else G+=.02*(R-G),F+=.02*(Q-F),k=W;C+=.11*(k*g*O-C);mainCtx.translate(d-=G*C,E-=F*C);mainCtx.scale(C,
C);l.sort(ya);k=l.length;for(g=0;g<k;g++)n=l[g],n.draw(a);mainCtx.scale(t=1/C,t);mainCtx.translate(-d,-E);mainCtx.scale(e,e);$("#statsFPS").html(~~fps);$("#statsPing").html(X+" ms");$("#statsScore").html(L);I&&mainCtx.drawImage(I,c/e-I.width-20,20);0<chatMessages.length&&1!==ka()&&N();chatCanvas&&mainCtx.drawImage(chatCanvas,10,(m-50)/e-chatCanvas.height);mainCtx.scale(e=1/e,e);var a=Date.now(),y;for(y in p)for(var B in p[y])3E3<a-p[y][B].accessTime&&(delete p[y][B],0===Object.keys(p[y]).length&&
delete p[y]);for(y in q)3E3<a-q[y].accessTime&&delete q[y];for(y in A)6E4<a-A[y].accessTime&&delete A[y]}function ya(a,c){return a.size===c.size?a.id-c.id:a.size-c.size}function ia(a,c,b,d,f,e,g,l,k){this.id=a;this.x=this.nx=c;this.y=this.ny=b;this.size=this.nSize=d;this.setName(f);this.setColor(e);this.skin=g;k&&(this.isEjected=!!(k&32),this.isVirus=!!(k&1),this.isAgitated=!!(k&16),(this.isEjected||this.isVirus||this.isAgitated)&&(this.notPellet=!0));this.birthStamp=this.updateStamp=l}function da(a,
c,b,d){return d?(b=a?3:1.02,a?(1===c%2?-b:b)+Math.random()-1.5:(Math.random()-.5)*b*2):a?1===c%2?-3:3:0}function qa(a,c){var b=document.createElement("canvas"),d=b.getContext("2d"),E=f.showTextOutline?f.qualityRef.getTextLineWidth(c):0;d.font=c+"px Montserrat";b.width=d.measureText(a).width;b.height=1.2*c;d.font=c+"px Montserrat";d.fillStyle="#FFFFFF";d.lineWidth=E;d.strokeStyle="#000000";0<E&&d.strokeText(a,0,c);d.fillText(a,0,c);!p[a]&&(p[a]={});p[a][c]={canvas:b,accessTime:Date.now()};return b}
function za(a,c){if(!p[a])return qa(a,c);var b=~~(.1*c),d;if(d=p[a][c])return d.accessTime=Date.now(),d.canvas;for(var f=1;f<b;f++)if((d=p[a][c+f])||(d=p[a][c-f]))return d.accessTime=Date.now(),d.canvas;return qa(a,c)}function Aa(a){if(q[a])return q[a].accessTime=Date.now(),q[a];for(var c,b=~~(.1*a),d=0;d<b;d++)if((c=q[a-d])||(c=q[a+d]))return c.accessTime=Date.now(),c;var e;c=[{c:e=document.createElement("canvas"),t:e.getContext("2d"),w:NaN},{c:e=document.createElement("canvas"),t:e.getContext("2d"),
w:NaN},{c:e=document.createElement("canvas"),t:e.getContext("2d"),w:NaN},{c:e=document.createElement("canvas"),t:e.getContext("2d"),w:NaN},{c:e=document.createElement("canvas"),t:e.getContext("2d"),w:NaN},{c:e=document.createElement("canvas"),t:e.getContext("2d"),w:NaN},{c:e=document.createElement("canvas"),t:e.getContext("2d"),w:NaN},{c:e=document.createElement("canvas"),t:e.getContext("2d"),w:NaN},{c:e=document.createElement("canvas"),t:e.getContext("2d"),w:NaN},{c:e=document.createElement("canvas"),
t:e.getContext("2d"),w:NaN}];e=0;for(var b=f.showTextOutline?f.qualityRef.getTextLineWidth(a):0,k,g=a+5*b+2;10>e;e++)k=c[e].c,d=c[e].t,d.font=a+"px Montserrat",c[e].w=(k.width=d.measureText(e).width+3*b)-3*b,k.height=g,d.font=a+"px Montserrat",d.fillStyle="#FFFFFF",d.lineWidth=b,d.strokeStyle="#000000",0<b&&d.strokeText(e,b,a),d.fillText(e,b,a);q[a]={canvasList:c,height:g,accessTime:Date.now()};return q[a]}function ea(a,c,b,d,e){if(!(5E3<d))if(e){d=Aa(d);b=b.toString();var f=0;e=0;for(c-=.5*d.height;e<
b.length;e++)f+=d.canvasList[parseInt(b[e])].w;a-=.5*f;for(e=0;e<b.length;e++)f=d.canvasList[parseInt(b[e])],mainCtx.drawImage(f.c,a,c),a+=f.w}else d=za(b,d),w=d.width,h=d.height,mainCtx.drawImage(d,a-.5*w,c-.5*h,w,h)}function Ba(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))}function Ca(){if(L>P){P=L;var a=J,c="N/A",b=/\{([^]+)\}/.exec(a);b&&2===b.length&&(c=b[1],a=a.replace(b[0],"").trim());$.get("/api/hiscores/post?name="+a+"&clan="+
c+"&score="+P+"&mode="+connected.name.toLowerCase()+"&build="+config.build+"&hash="+Ba(P),function(a){})}}var P=0,S=0,na={red:"#FF3333",green:"#33FF33",blue:"#3333FF",yellow:"#FFFF33",cyan:"#33FFFF",magenta:"#FF33FF",orange:"#FF8833"},la="",ma="";-1!=navigator.appVersion.indexOf("MSIE")&&alert("You're using a pretty old browser, some parts of the website might not work properly.");Date.now||(Date.now=function(){return(+new Date).getTime()});Array.prototype.peek=function(){return this[this.length-
1]};var ga={top:-2E3,left:-2E3,right:2E3,bottom:2E3},ca=2*Math.PI,ta=new Uint8Array([254,6,0,0,0]),ua=new Uint8Array([255,1,0,0,0]),B={1:new Uint8Array([1]),17:new Uint8Array([17]),21:new Uint8Array([21]),18:new Uint8Array([18]),19:new Uint8Array([19]),22:new Uint8Array([22]),23:new Uint8Array([23]),24:new Uint8Array([24]),254:new Uint8Array([254])};FPS_MAXIMUM=1E3;ws=null;disconnectDelay=1;var v={},M=[],U=[],D=[],u=[],x=-1,I=null,L=0,G=0,F=0,R=0,Q=0,W=1,Z=!1,ra=0,sa=0,z=ga,A=[],C=1,H=1,O=1,Y=-1,
X=-1,J="",xa="#FF3333 #33FF33 #3333FF #FFFF33 #33FFFF #FF33FF #FF8833".split(" ");serverVersion="Unknown";chatText="";chatMessages=[];chatAlphaWait=0;chatCanvas=null;isTyping=!1;isWindowFocused=!0;chatBox=mainCtx=mainCanvas=null;lastDrawTime=Date.now();escOverlay=!1;fps=0;serverStatCanvas=serverStats=serverStatID=null;_viewMult=1;pressed={space:!1,w:!1,e:!1,r:!1,t:!1,p:!1,q:!1,esc:!1};var fa={"default":{getTextLineWidth:function(a){return.05*a+3},cellOutline:!1,smoothRender:.1,overrideGrid:!1,overrideSkins:!1,
drawStat:!0,drawMassSpectate:!0}},f={mobile:"createTouch"in document,showMass:!0,showNames:!0,showLeaderboard:!0,showChat:!0,showGrid:!1,showTextOutline:!1,clippedNames:!1,bigNames:!0,showColor:!0,showSkins:!0,darkTheme:!0,transparentCells:!1,monoZoom:!1,transparency:.8,detailedVirus:!1,autoRespawn:!1,fastRenderMax:Infinity,spinnerMode:!1,quality:"default",qualityRef:fa["default"],allowGETipSet:!1};null!=b.localStorage&&k(window).load(function(){k(".save").each(function(){var a=$(this).data("box-id"),
c=b.localStorage.getItem("checkbox-"+a);c&&"true"==c&&0!=a?($(this).prop("checked","true"),$(this).trigger("change")):0==a&&null!=c&&$(this).val(c)});k(".save").change(function(){var a=$(this).data("box-id"),c=0==a?$(this).val():$(this).prop("checked");b.localStorage.setItem("checkbox-"+a,c)})});$.get("/api/skins",function(a){knownSkins=JSON.parse(a);setTimeout(function(){ui.updateSkin()},3E3)});ia.prototype={destroyed:!1,id:0,x:0,y:0,size:0,name:0,color:"#FFFFFF",nameSkin:"",skin:"",updateStamp:-1,
birthStamp:-1,deathStamp:-1,appStamp:-1,nx:0,ny:0,nSize:0,killer:null,rigidPoints:[],isEjected:!1,isPellet:!1,notPellet:!1,isVirus:!1,isAgitated:!1,strokeColor:"#AAAAAA",_nameSize:0,_meCache:null,_meW:null,_meH:null,updateAppearance:function(a,c){if(this.destroyed&&(200<a-this.deathStamp||!this.killer||4>this.size)){var b;-1<(b=U.indexOf(this))&&U.splice(b,1)}this.killer&&(this.nx=this.killer.x,this.ny=this.killer.y,this.nSize=0);this.x+=(this.nx-this.x)*c;this.y+=(this.ny-this.y)*c;this.size+=(this.nSize-
this.size)*c;this._nameSize=4*~~(Math.max(~~(.3*this.nSize),24)/4)},setName:function(a){var c=/\[([^]+)\]/.exec(a);c&&2===c.length?(this.nameSkin=c[1],this.name=f.showSkins?a.replace(c[0],"").trim():a):this.name=a},setSkin:function(a){this.skin="%"===a[0]?a.replace("%",""):a},setColor:function(a){this.color=a;var c=(~~(.9*parseInt(a.substr(1,2),16))).toString(16),b=(~~(.9*parseInt(a.substr(3,2),16))).toString(16);a=(~~(.9*parseInt(a.substr(5,2),16))).toString(16);1==c.length&&(c="0"+c);1==b.length&&
(b="0"+b);1==a.length&&(a="0"+a);this.strokeColor="#"+c+b+a},destroy:function(a){delete v[this.id];var c;-1!==(c=M.indexOf(this))&&M.splice(c,1);-1!==(c=D.indexOf(this.id))&&D.splice(c,1);-1<c&&0===D.length&&(R=G,Q=F,W=H,P=L=0,streaks=[],f.autoRespawn||V(),msend(1),f.autoRespawn&&ja(J));U.push(this);this.deathStamp=a;this.destroyed=!0},updatePoints:function(a,c,b){var d=this.size;var e=c?90:this.isPellet?5:16;var f=this.x,k=this.y,m=.16*this.size,g=0;!this.isVirus&&(d*=C);this.isEjected&&(d*=.5);
d=Math.max(~~d,e);c&&(d=2*~~(.5*d));var p=ca/d;for(var u=[];g<d;g++){if(this.rigidPoints[g]&&a){var q=this.rigidPoints[g];e=q.newDiff;q=q.diff+(e-q.diff)*b;var r=q-e;0>r&&(r=-r);.05>=r&&(e=da(c,g,d,a))}else a?(e=da(c,g,d,a),q=0):q=e=da(c,g,d,a);r=this.size+q;var A=Math.sin(g*p),y=Math.cos(g*p);var v=f+A*r;var x=k+y*r;var B=0,D=0;v+=B;x+=D;v<z.left&&(B-=A*Math.min(z.left-v,m));v>z.right&&(B-=A*Math.min(v-z.right,m));x<z.top&&(D-=y*Math.min(z.top-x,m));x>z.bottom&&(D-=y*Math.min(x-z.bottom,m));v+=B;
x+=D;u.push({refID:this.id,size:r,diff:q,newDiff:e,x:v,y:x})}this.rigidPoints=u},draw:function(a){var c=Math.min(Math.max((a-this.appStamp)/120,0),1);this.appStamp=a;mainCtx.save();this.drawShape(c);if(this.notPellet&&!this.isEjected&&(mainCtx.globalAlpha=1,a=f.showNames&&""!==this.name&&!this.isVirus&&100<=this.size,c=f.bigNames?1:2,a&&ea(this.x,this.y,this.name,this._nameSize*c,!1),f.showMass&&(-1!==D.indexOf(this.id)||f.qualityRef.drawMassSpectate)&&100<=this.size)){var b=Math.ceil(this.size*this.size*
.01).toString();a?ea(this.x,this.y+Math.max(.22*this.size,1.5*this._nameSize),b,this._nameSize,!0):this.isVirus||f.detailedVirus&&f.showTextOutline||ea(this.x,this.y,b,this._nameSize*c,!0)}mainCtx.restore()},drawShape:function(a){var c=this.wasComplexDrawing=f.fastRenderMax<=C,b=this.isVirus;f.detailedVirus||(b=!1);mainCtx.lineWidth=f.qualityRef.cellOutline?this.isEjected?0:20<this.size?Math.max(.01*this.size,10):0:0;mainCtx.lineCap="round";mainCtx.lineJoin="round";mainCtx.fillStyle=!f.spinnerMode||
this.isPellet||this.isEjected||this.isVirus?this.color:f.darkTheme?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.15)";mainCtx.strokeStyle=!f.spinnerMode||this.isPellet||this.isEjected||this.isVirus?this.color:"rgba(0,0,0,0)";f.transparentCells&&(mainCtx.globalAlpha=f.transparency);!f.detailedVirus&&this.isVirus&&(mainCtx.globalAlpha="0.6",mainCtx.fillStyle="#b2b2b2",mainCtx.strokeStyle="#FFFFFF");f.showColor||(this.isEjected?(mainCtx.globalAlpha="1",mainCtx.fillStyle="#b2b2b2",mainCtx.strokeStyle="#FFFFFF"):
this.isVirus||this.isEjected||(mainCtx.fillStyle="#b2b2b2",mainCtx.strokeStyle="#FFFFFF"));if("clanwars"==connected.name.toLowerCase()){var d=/\{([^]+)\}/.exec(this.name);d&&2===d.length&&(pastClans[d[1]]?(mainCtx.fillStyle=pastClans[d[1]],mainCtx.strokeStyle=pastClans[d[1]],mainCtx.lineWidth=.2*this.size):pastClans[d[1]]=plz())}if(c||b||this.isAgitated){mainCtx.beginPath();this.updatePoints(c,b,a);a=this.rigidPoints;mainCtx.moveTo(a[0].x,a[0].y);c=1;for(b=a.length;c<b;c++)mainCtx.lineTo(a[c].x,a[c].y);
mainCtx.lineTo(a[0].x,a[0].y);mainCtx.fill();mainCtx.stroke();this.drawSkin();mainCtx.closePath()}else this.rigidPoints=[],this._meCache?mainCtx.drawImage(this._meCache,this.x-this.size,this.y-this.size,2*this.size,2*this.size):(mainCtx.beginPath(),mainCtx.arc(this.x,this.y,this.size-.5*mainCtx.lineWidth+.5,0,ca,!1),mainCtx.fill(),f.qualityRef.cellOutline&&mainCtx.stroke(),this.drawSkin(),mainCtx.closePath())},drawSkin:function(){if(!f.qualityRef.overrideSkins){var a=this.skin||this.nameSkin||this.name.toLowerCase();
-1!==$.inArray(a,knownSkins)||isurl(a)||(a="");f.spinnerMode&&(A[a]=new Image,A[a].src="http://spinz.io/asset/image/entity/player/player-t6-base.svg");if(f.showSkins&&""!=a){var c=isurl(a)?a:"./skins/"+a.toLowerCase()+".png";A.hasOwnProperty(a)||(A[a]=new Image,A[a].src=c);0!=A[a].width&&A[a].complete&&(A[a].accessTime=Date.now(),f.clippedNames||mainCtx.save(),mainCtx.clip(),mainCtx.drawImage(A[a],this.x-this.size,this.y-this.size,2*this.size,2*this.size),f.clippedNames||mainCtx.restore())}}}};var p=
{},q={};b.setserver=function(a){NProgress.start();e();ws&&e();J=$("#nick").val();ws=new WebSocket("ws://"+a);ws.binaryType="arraybuffer";ws.onopen=g;ws.onmessage=K;ws.onerror=va;ws.onclose=wa;$("#serverConnectingText").html("Connecting...");$("#serverConnecting").show();$("#mainButtons").hide();$("#statsPing").html("0");$("#statsScore").html("0");$("#statsPlayers").html("0");$("#statsPlaying").html("0");$("#statsSpec").html("0")};b.leaveserver=function(){e();$("#statsPing").html("0");$("#statsScore").html("0");
$("#statsPlayers").html("0");$("#statsPlaying").html("0");$("#statsSpec").html("0")};b.pushChat=function(a,c,b){chatMessages.push({server:!1,admin:!1,mod:!1,nameColor:b,name:a,message:c,time:Date.now()});N()};b.setDarkTheme=function(a){f.darkTheme=a;ha()};b.setShowMass=function(a){f.showMass=a};b.setSkins=function(a){f.showSkins=a;p={};q={}};b.setColors=function(a){f.showColor=!a;0===f.qualityRef.getTextLineWidth(100)&&(p={},q={})};b.setNames=function(a){f.showNames=a};b.setSmooth=function(a){f.fastRenderMax=
a?Infinity:f.qualityRef.smoothRender};b.setChatHide=function(a){f.showChat=!a;N()};b.setShowGrid=function(a){f.showGrid=a};b.setTransparent=function(a){f.transparentCells=a};b.setMonoZoom=function(a){f.monoZoom=a};b.setTransparency=function(a){f.transparency=a};b.setDetailedVirus=function(a){f.detailedVirus=a};b.setAutoRespawn=function(a){f.autoRespawn=a};b.setCellOutline=function(a){f.qualityRef.cellOutline=a;p={};q={}};b.setSpinnerMode=function(a){f.spinnerMode=a};b.setTextOutline=function(a){f.showTextOutline=
a;p={};q={}};b.setBigNames=function(a){f.bigNames=a;p={};q={}};b.setClippedNames=function(a){f.clippedNames=a;p={};q={}};b.setGrowAnimation=function(a){f.fastRenderMax=a};b.setQuality=function(a){fa[a]&&f.quality!==a&&(f.quality=a,f.qualityRef=fa[a],f.fastRenderMax=4==f.fastRenderMax?4:f.qualityRef.smoothRender,p={},q={})};b.spectate=function(a){r(B[1]);L=0;ba()};b.play=function(a){function c(a){$("#warningText").html(a);$("#warning").show();$("#warningInner").animateCss("bounceIn");pushChat("INFO",
a,na.red);$("#clan").val("");$("#clan").focus();setTimeout(function(){$("#warning").fadeOut()},3E3)}$("#clan").val($("#clan").val().toUpperCase());var b=$("#clan").val();"clanwars"==connected.name.toLowerCase()&&""==b.replace(/\s/g,"")?c("You need a clan to play ClanWars!"):/\s/g.exec(b)?c("A clan name cannot include spaces."):3<b.length?c("Your clan name cannot be more than 3 characters long."):(ja(a),ba())};b.openSkinsList=function(){setTimeout(function(){"Skins"!=$("#inPageModalTitle").text()&&
$.get("/api/include/gallery").then(function(a){$("#inPageModalTitle").text("Skins");$("#inPageModalBody").html(a)})},1E3)};b.openPlaylist=function(){setTimeout(function(){"Playlist"!=$("#playlistTitle").text()&&$.get("/api/include/playlist").then(function(a){$("#playlistTitle").text("Playlist");$("#playlistBody").html(a)})},1E3)};var T={limit:10,get:function(a){$.get("/api/hiscores/get?limit="+T.limit+"&mode="+$("#hiscoresMode").val().toLowerCase(),function(a){$("#hiscoresBlock").html(a.replace("<script>",
"").replace("\x3c/script>",""))}).always(function(){a||setTimeout(function(){T.get()},1E4)})},set:function(a){T.limit=a}};setInterval(function(){Ca()},1E4);document.getElementById("hiscoresMode").onchange=function(){T.get(!0)};document.getElementById("hiscoresLimit").onchange=function(){T.set($("#hiscoresLimit").val())};T.get();setTimeout(function(){J=$("#nick").val()?$("#nick").val():"An unnamed cell"},500);b.getUserName=function(){return J};setInterval(function(){if(P){var a=P,c;1E5<a?c="100k":
75E3<a?c="100k":5E4<a?c="75k":3E4<a?c="50k":25E3<a?c="25k":2E4<a?c="20k":15E3<a?c="15k":1E4<a?c="10k":8E3<a?c="8k":5E3<a?c="5k":3E3<a?c="3k":1E3<a&&(c="1k");c&&-1==$.inArray(c,streaks)&&(streaks.push(c),msend(9,!1,c))}},3E3);b.onload=function(){function a(a){0< !$(".modal.in").length&&!$("#overlays").is(":visible")&&(O*=Math.pow(.9,a.wheelDelta/-120||a.detail||0),1*O>O&&(O=1),O>4/H&&(O=4/H))}mainCanvas=document.getElementById("canvas");mainCtx=mainCanvas.getContext("2d");chatBox=document.getElementById("chat_textbox");
mainCanvas.focus();/firefox/i.test(navigator.userAgent)?document.addEventListener("DOMMouseScroll",a,!1):document.body.onmousewheel=a;window.onfocus=function(){isWindowFocused=!0};window.onblur=function(){isWindowFocused=!1};b.onkeydown=function(a){switch(a.keyCode){case 13:if(escOverlay)break;if(!f.showChat)break;if(isTyping){chatBox.blur();a=chatBox.value;if(0<a.length){if(200<a.length)chatMessages.push({server:!1,admin:!1,mod:!1,nameColor:"#FF0000",name:"Cigar",message:"Too large message!",time:Date.now()}),
N();else{var b=new Writer;b.setUint8(99);b.setUint8(0);b.setStringUTF8(a);r(b)}msend(11,!1,a)}chatBox.value=""}else chatBox.focus();break;case 32:if(isTyping||escOverlay||pressed.space)break;r(B[17]);pressed.space=!0;break;case 87:if(isTyping||escOverlay||pressed.w)break;r(B[21]);pressed.w=!0;break;case 81:if(isTyping||escOverlay||pressed.q)break;r(B[18]);pressed.q=!0;break;case 69:if(isTyping||escOverlay||pressed.e)break;r(B[22]);pressed.e=!0;break;case 82:if(isTyping||escOverlay||pressed.r)break;
r(B[23]);pressed.r=!0;break;case 84:if(isTyping||escOverlay||pressed.t)break;r(B[24]);pressed.t=!0;break;case 80:if(isTyping||escOverlay||pressed.p)break;r(B[25]);pressed.p=!0;break;case 27:pressed.esc||(pressed.esc=!0,escOverlay?ba():V())}};b.onkeyup=function(a){switch(a.keyCode){case 32:pressed.space=!1;break;case 87:pressed.w=!1;break;case 81:pressed.q&&r(B[19]);pressed.q=!1;break;case 69:pressed.e=!1;break;case 82:pressed.r=!1;break;case 84:pressed.t=!1;break;case 80:pressed.p=!1;break;case 27:pressed.esc=
!1}};chatBox.onblur=function(){isTyping=!1;N()};chatBox.onfocus=function(){isTyping=!0;N()};mainCanvas.onmousemove=function(a){ra=a.clientX;sa=a.clientY};setInterval(function(){var a=(ra-mainCanvas.width/2)/C+G,b=(sa-mainCanvas.height/2)/C+F,d=new Writer(!0);d.setUint8(16);d.setUint32(a);d.setUint32(b);d._b.push(0,0,0,0);r(d)},40);b.onresize=function(){var a=mainCanvas.width=b.innerWidth,e=mainCanvas.height=b.innerHeight;_viewMult=Math.min(e/1080,a/1920)};b.onresize();log.info("Loaded, took "+(Date.now()-
LOAD_START)+" ms");window.requestAnimationFrame?window.requestAnimationFrame(oa):setInterval(pa,1E3/FPS_MAXIMUM);V()}})(window,window.jQuery);
